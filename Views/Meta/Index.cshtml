@using FluentBlog.Models
@model FluentBlog.ViewModels.MetaViewModel
<style>
    .view {
        width: 100%;
        height: 0;
        padding-bottom: 30%;
        overflow: hidden;
    }
</style>

<div>
    <div class="card mb-4 shadow">
        <div class="card-body">
            @{
                string pageInfo = "";
                if (Model.PageNum != 1)
                {
                    pageInfo = " - " + "第" + Model.PageNum + "页";
                }
                switch (Model.CurrentMeta.Type)
                {
                    case "category":
                        <h2 class="card-title font-weight-bold m-0">分类：@Model.CurrentMeta.Name@pageInfo</h2>
                        break;
                    case "tag":
                        <h2 class="card-title font-weight-bold m-0">标签：@Model.CurrentMeta.Name@pageInfo</h2>
                        break;
                }
            }
        </div>
    </div>
</div>

@{
    for (int i = 0; i < Model.Archives.Count; i++)
    {
        <!--文章块-->
        <div class="card mb-4 shadow">

            <!--标题图-->
            <div class="view">
                <a asp-controller="Archive" asp-action="Index" asp-route-aid="@Model.Archives[i].Aid">
                    <img src=@Model.Archives[i].TitleImage class="img-fluid card-img-top" alt="photo">
                </a>
            </div>

            <!--主体-->
            <div class="card-body">
                <!--标题-->
                <h3 class="card-title font-weight-bold">
                    <a id="title" class="text-dark text-decoration-none" asp-controller="Archive" asp-action="Index" asp-route-aid="@Model.Archives[i].Aid">@Model.Archives[i].Title</a>
                    @if (i == 0 && Model.PageNum == 1)
                    {
                        <span class="badge badge-success">New</span>
                    }
                </h3>

                <!--分类-->
                <div class="my-2">
                    @{
                        for (int j = 0; j < Model.Categories[i].Count; j++)
                        {
                            <span class="pl-0 pr-2 m-0">
                                <a class="btn btn-sm m-0 py-0 @Model.CategoryColors[j]" asp-controller="Meta" asp-action="Index" asp-route-slug="@Model.Categories[i][j].Slug">@Model.Categories[i][j].Name</a>
                            </span>
                        }
                    }
                </div>


                <!--概要-->
                <p class="card-text">
                    @{
                        if (Model.Archives[i].Text.Length > 300)
                        {
                            @(Model.Archives[i].Text.Substring(0, 300) + "…")
                        }
                        else
                        {
                            @Model.Archives[i].Text
                        }
                    }
                </p>
                <a class="text-primary" asp-controller="Archive" asp-action="Index" asp-route-aid="@Model.Archives[i].Aid">
                    阅读全文
                    <i class="mi mi-ChevronRight"></i>
                </a>
            </div>
            <!--信息和数据-->
            <div class="card-footer bg-transparent d-flex justify-content-around">
                <span class="text-muted">
                    <i class="mi mi-People"></i> @Model.Authors[i].DisplayName
                </span>
                <span class="text-muted">
                    <i class="mi mi-Calendar"></i> @Model.Archives[i].Created.ToShortDateString()
                </span>
                <span class="text-muted">
                    <i class="mi mi-View"></i> @Model.Archives[i].Views
                </span>
                <span class="text-muted">
                    <i class="mi mi-Comment"></i> @Model.Archives[i].CommentsNum
                </span>
            </div>
        </div>
    }
}
<!--分页导航-->
<nav id="page-navigation">
    <ul class="pagination justify-content-center">
        <li class="page-item shadow">
            <a class="page-link text-dark" asp-controller="Meta" asp-action="Index" asp-route-slug="@Model.CurrentMeta.Slug" aria-label="First">
                <span aria-hidden="true">
                    <i class="mi mi-ChevronLeft"></i> 首页
                </span>
            </a>
        </li>
        @if (Model.PageNum != 1)
        {
            <li class="page-item shadow">
                <a class="page-link text-dark" asp-controller="Meta" asp-action="Index" asp-route-slug="@Model.CurrentMeta.Slug" asp-route-page="@(Model.PageNum - 1)">@(Model.PageNum - 1)</a>
            </li>
        }
        <li class="page-item shadow active">
            <a class="page-link text-dark">@Model.PageNum</a>
        </li>
        @if (Model.PageNum != Model.PageCount)
        {
            <li class="page-item shadow">
                <a class="page-link text-dark" asp-controller="Meta" asp-action="Index" asp-route-slug="@Model.CurrentMeta.Slug" asp-route-page="@(Model.PageNum + 1)">@(Model.PageNum + 1)</a>
            </li>
        }
        <li class="page-item shadow">
            <a class="page-link text-dark" asp-controller="Meta" asp-action="Index" asp-route-slug="@Model.CurrentMeta.Slug" asp-route-page="@Model.PageCount" aria-label="Last">
                <span aria-hidden="true">
                    末页 <i class="mi mi-ChevronRight"></i>
                </span>
            </a>
        </li>
    </ul>
</nav>

@section Scripts{
    <script src="~/js/CustomScript.js"></script>
}