@using FluentBlog.Models
@model FluentBlog.ViewModels.HomeViewModel
<style>
    .view {
        width: 100%;
        height: 0;
        padding-bottom: 30%;
        overflow: hidden;
    }
</style>

<!-- 显示当前选择的分类 -->
@if (Model.CurrentMeta != null)
{
    <div>
        <div class="card mb-4 shadow">
            <div class="card-body">
                @{
                    string pageInfo = "";
                    if (Model.PageNum != 1)
                    {
                        pageInfo = " - " + "第" + Model.PageNum + "页";
                    }
                    switch (Model.CurrentMeta.Type)
                    {
                        case "category":
                            <h2 class="card-title font-weight-bold m-0">分类：@Model.CurrentMeta.Name@pageInfo</h2>
                            break;
                        case "tag":
                            <h2 class="card-title font-weight-bold m-0">标签：@Model.CurrentMeta.Name@pageInfo</h2>
                            break;
                    }
                }
            </div>
        </div>
    </div>
}

@{
    for (int i = 0; i < Model.Archives.Count; i++)
    {
        <!--文章块-->
        <div class="card mb-4 shadow">

            <!--标题图-->
            <div class="view">
                <a asp-controller="Home" asp-action="Archive" asp-route-aid="@Model.Archives[i].Aid">
                    <img src=@Url.Content(Model.Archives[i].TitleImage) class="img-fluid card-img-top" alt="photo">
                </a>
            </div>

            <!--主体-->
            <div class="card-body">
                <!--标题-->
                <h3 class="card-title font-weight-bold m-0">
                    <a id="title" class="text-dark text-decoration-none" asp-controller="Home" asp-action="Archive" asp-route-aid="@Model.Archives[i].Aid">@Model.Archives[i].Title</a>
                    @if (i == 0 && Model.PageNum == 1)
                    {
                        <span class="badge badge-success">New</span>
                    }
                </h3>

                <!--分类-->
                <div class="my-2">
                    @{
                        for (int j = 0; j < Model.Categories[i].Count; j++)
                        {
                            <span class="pl-0 pr-2 m-0">
                                <a class="btn btn-sm m-0 py-0 @Model.CategoryColors[j%5]" asp-controller="Home" asp-action="Index" asp-route-slug="@Model.Categories[i][j].Slug">@Model.Categories[i][j].Name</a>
                            </span>
                        }
                    }
                </div>


                <!--概要-->
                <p class="card-text">
                    @{
                        if (Model.Archives[i].Text.Length > 300)
                        {
                            @(Model.Archives[i].Text.Substring(0, 300) + "…")
                        }
                        else
                        {
                            @Model.Archives[i].Text
                        }
                    }
                </p>
                <a class="card-link" asp-controller="Home" asp-action="Archive" asp-route-aid="@Model.Archives[i].Aid">
                    阅读全文
                    <i class="mi mi-ChevronRight"></i>
                </a>
            </div>
            <!-- 文章信息 -->
            <div class="card-footer bg-transparent d-flex justify-content-around">
                <span class="text-muted">
                    <i class="mi mi-Contact" data-toggle="tooltip" data-placement="top" title="作者"></i> @Model.Authors[i].DisplayName
                </span>
                <span class="text-muted">
                    <i class="mi mi-Calendar" data-toggle="tooltip" data-placement="top" title="发表日期"></i> @Model.Archives[i].Created.ToShortDateString()
                </span>
                <span class="text-muted">
                    <i class="mi mi-View" data-toggle="tooltip" data-placement="top" title="阅读次数"></i> @Model.Archives[i].Views
                </span>
                <span class="text-muted">
                    <i class="mi mi-Comment" data-toggle="tooltip" data-placement="top" title="评论数"></i> @Model.Archives[i].CommentsNum
                </span>
            </div>
        </div>
    }
}
<!--分页导航-->
<nav id="page-navigation">
    <ul class="pagination justify-content-center">
        <!--首页-->
        <li class="page-item shadow">
            <a class="page-link text-dark" asp-controller="Home" asp-action="Index" asp-route-slug="@(Model.CurrentMeta?.Slug)" asp-route-page="">
                <span aria-hidden="true">
                    <i class="mi mi-ChevronLeft"></i> 首页
                </span>
            </a>
        </li>
        <!--前一页-->
        @if (Model.PageNum != 1)
        {
            <li class="page-item shadow">
                <a class="page-link text-dark" asp-controller="Home" asp-action="Index" asp-route-slug="@Model.CurrentMeta?.Slug" asp-route-page="@(Model.PageNum - 1)">@(Model.PageNum - 1)</a>
            </li>
        }
        <!--当前页-->
        <li class="page-item shadow active">
            <a class="page-link text-dark">@Model.PageNum</a>
        </li>
        <!--后一页-->
        @if (Model.PageNum != Model.PageCount)
        {
            <li class="page-item shadow">
                <a class="page-link text-dark" asp-controller="Home" asp-action="Index" asp-route-slug="@Model.CurrentMeta?.Slug" asp-route-page="@(Model.PageNum + 1)">@(Model.PageNum + 1)</a>
            </li>
        }
        <!--末页-->
        <li class="page-item shadow">
            <a class="page-link text-dark" asp-controller="Home" asp-action="Index" asp-route-slug="@Model.CurrentMeta?.Slug" asp-route-page="@Model.PageCount">
                <span aria-hidden="true">
                    末页 <i class="mi mi-ChevronRight"></i>
                </span>
            </a>
        </li>
    </ul>
</nav>

@section SecondSidebar{
    <!-- 动态栏 -->
    @if (ViewBag.Settings["FeedSwitch"] == "on")
    {
        @await Component.InvokeAsync("FeedBlock")
    }
}

@section Scripts{
    <script src="~/js/CustomScript.js"></script>
}